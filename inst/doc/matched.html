<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Panaghis Mavrokefalos" />


<title>Calculating optimal parameters from matched data</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Calculating optimal parameters from matched data</h1>
<h4 class="author">Panaghis Mavrokefalos</h4>



<div id="a-quick-example" class="section level1">
<h1>A quick example</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maxscoreest)</span></code></pre></div>
<p>First, we need to import the data into R. Let’s use some synthetic data provided with the package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;precomp_testdata.dat&quot;</span>, <span class="at">package =</span> <span class="st">&quot;maxscoreest&quot;</span>)</span></code></pre></div>
<p>We import this using the function <code>importMatched</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>matchedData <span class="ot">&lt;-</span> <span class="fu">importMatched</span>(filename)</span></code></pre></div>
<p>Next, we need to calculate the <em>inequality members</em>, which are lists of indices of the pairings that participate in the inequalities defining the objective function. The function <code>Cineqmembers</code> uses the matching information, contained in the list member <code>$mate</code>, to create these indices.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ineqmembers <span class="ot">&lt;-</span> <span class="fu">Cineqmembers</span>(matchedData<span class="sc">$</span>mate)</span></code></pre></div>
<p>Now we can use the inequalities to create the <em>data array</em>. The function <code>CdataArray</code> uses the indices of the inequality members to gather and combine values from the distance matrices. Here, a <em>distance</em> is an attribute that characterizes a pair composed of upstream and downstream agents (e.g. geographic distance between the agents, or their age multiplied, etc.).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dataArray <span class="ot">&lt;-</span> <span class="fu">CdataArray</span>(matchedData<span class="sc">$</span>distanceMatrices, ineqmembers)</span></code></pre></div>
<p>Next, we need to set up the optimization procedure.</p>
<hr />
<div id="an-important-note-regarding-optimization" class="section level2">
<h2>An important note regarding optimization</h2>
<p>We are optimizing a non-smooth, non-convex objective function, so the general-purpose optimization methods are ill-suited for this problem. We are currently supporting only the <em>Differential Evolution</em> method (implemented in the package <code>DEoptim</code>), but this is a <strong>non-deterministic</strong> method. A user can fix the RNG seed on their setup, but there is no guarantee of reproducibility across different machines, operating systems, R versions, or package versions.</p>
<p>These two facts stated above complicate the optimization in the following ways:</p>
<ul>
<li>The objective function is non-convex: this means that there is no guarantee of reaching the global optimum using local search methods.</li>
<li>The objective function is non-smooth, and actually piecewise constant: this means that the objective attains its (global) optimum for infinitely many points. Even worse, there are potentially many disconnected subsets of the search space on which the objective attains its optimum.</li>
</ul>
<p>Differential Evolution works very well in practice however, either finding the global optimum or approximating it very closely.</p>
<hr />
<p>Let’s use the default parameters for Differential Evolution, and select a box constraint for the paramater estimates of <span class="math inline">\([-100, 100]\)</span>. The user needs to decide whether to restrict the parameter estimates to some bounds, whether the bounds are symmetrical, etc. See below under “Optimization” a discussion of these issues.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>bounds <span class="ot">&lt;-</span> <span class="fu">makeBounds</span>(matchedData<span class="sc">$</span>noAttr, <span class="dv">100</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>optimParams <span class="ot">&lt;-</span> <span class="fu">getDefaultOptimParams</span>()</span></code></pre></div>
<p>We might also want to fix the RNG for reproducibility across runs. This is highly recommended. See the <em>note regarding optimization</em> above.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>randomSeed <span class="ot">&lt;-</span> <span class="dv">42</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(randomSeed)</span></code></pre></div>
<p>We are now ready to perform the optimization. The function <code>optimizeScoreFunction</code> creates and optimizes the objective. Note that we don’t have to pass the arguments via <code>do.call</code>, but since we’ll need the argument list later when calculating the confidence region, this way is more convenient.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>optimizeScoreArgs <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">dataArray =</span> dataArray,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">bounds =</span> bounds,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">optimParams =</span> optimParams,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">getIneqSat =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">permuteInvariant =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">numRuns =</span> <span class="dv">1</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">progressUpdate =</span> <span class="dv">0</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>optResult <span class="ot">&lt;-</span> <span class="fu">do.call</span>(optimizeScoreFunction, optimizeScoreArgs)</span></code></pre></div>
<p>The rest of the (optional) arguments are explained below:</p>
<ul>
<li><code>getIneqSat</code>: Whether to include the boolean vector of satisfied inequalities <code>$ineqSat</code> in the result.</li>
<li><code>permuteInvariant</code>: Whether to reorder the attributes rows of the data array before and after the optimization, such that the attribute whose row has the smallest standard deviation comes first. Note that setting this to <code>TRUE</code> affects only the internal procedures, as the initial order is restored in the results. In addition to specifying the RNG, this feature is highly recommended in order to increase the likelihood that results are reproducible across runs and computers.</li>
<li><code>numRuns</code>: Setting this to an integer greater than <code>1</code> restarts the optimization method as many times as indicated by this integer. This is highly useful for methods such as Differential Evolution, because such methods can yield a different result depending on the random seed. Thus, this approach increases the likelihood that the user searches and finds the estimates that maximize a higher number of inequalities. The user can retrieve the runs with the best overall value from the member <code>$bestRuns</code> in the result. See the section “Restarting the optimization multiple times” below for more information.</li>
<li><code>progressUpdate</code>: If greater than <code>0</code>, prints a progress update to the console for the specified increment in the number of completed runs of the optimization procedure (e.g. every 8 runs, if the progress update is equal to <code>8</code>).</li>
</ul>
<p>We can now see the optimal parameter vector, and how many inequalities are satisfied across each market.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>optResult<span class="sc">$</span>optArg</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]   1.81745  -2.75489  87.03322 -17.54139</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>optResult<span class="sc">$</span>optVal</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.7111111</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">calcPerMarketStats</span>(optResult<span class="sc">$</span>ineqSat, <span class="fu">makeGroupIDs</span>(ineqmembers))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      Market ID Total inequalities Satisfied inequalities Satisfied/Total ratio</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]         1                 45                     34             0.7555556</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]         2                 45                     28             0.6222222</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]         3                 45                     34             0.7555556</span></span></code></pre></div>
</div>
</div>
<div id="calculating-the-confidence-intervals" class="section level1">
<h1>Calculating the confidence intervals</h1>
<p>Now that we have an optimal solution for the parameters, we can use it to calculate an estimate for the confidence regions. The procedure for constructing the confidence intervals is explained in detail by Fox (2018) – see both the text and the Supplementary Material. The procedure is based on Romano and Shaikh (2008).</p>
<p>To implement it, one needs to choose a number of iterations for the confidence regions calculation procedure (<code>numSubsamples</code>). In addition, if the asymptotics is in the number of markets (or nests), one needs to also choose the size of the market subsets of each iteration (<code>ssSize</code>). Alternatively, the asymptotics could be in the number of matches, but this approach is not implemented here. Fox (2018) provides an example in which confidence intervals are generated by subsampling from the number of matches within markets.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ssSize <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>numSubsamples <span class="ot">&lt;-</span> <span class="dv">50</span></span></code></pre></div>
<p>We also need to map each inequality to its market, using the function <code>makeGroupIDs</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>groupIDs <span class="ot">&lt;-</span> <span class="fu">makeGroupIDs</span>(ineqmembers)</span></code></pre></div>
<p>Now we are ready to calculate the confidence regions. We chose the standard value for the confidence level equal to <span class="math inline">\(0.95\)</span>, but this can be modified to any desired value.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>confidenceLevel <span class="ot">&lt;-</span> <span class="fl">0.95</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cr <span class="ot">&lt;-</span> <span class="fu">pointIdentifiedCR</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    dataArray, groupIDs, optResult<span class="sc">$</span>optArg,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    ssSize, numSubsamples, confidenceLevel,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    optimizeScoreArgs)</span></code></pre></div>
<p>We can use the function <code>plotCR</code> to visualize the confidence region estimates (centered around zero).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCR</span>(cr<span class="sc">$</span>estimates)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>We can also see which market subsets were chosen at each iteration.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cr<span class="sc">$</span>samples</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [,1] [,2]</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1,]    1    3</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [2,]    3    1</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3,]    3    1</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4,]    3    1</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5,]    2    3</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6,]    3    1</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7,]    1    3</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [8,]    1    3</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9,]    3    1</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10,]    2    3</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11,]    3    2</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [12,]    3    1</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13,]    1    3</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [14,]    2    3</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [15,]    1    3</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16,]    3    1</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17,]    3    1</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [18,]    1    3</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [19,]    1    3</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [20,]    3    2</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [21,]    2    1</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [22,]    2    3</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [23,]    2    3</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [24,]    3    1</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [25,]    1    2</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26,]    1    2</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [27,]    3    2</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [28,]    3    2</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [29,]    1    3</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [30,]    3    2</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [31,]    3    1</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [32,]    1    3</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [33,]    1    2</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [34,]    2    1</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [35,]    1    2</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [36,]    1    3</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [37,]    3    2</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [38,]    3    1</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39,]    2    1</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [40,]    2    3</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [41,]    1    2</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [42,]    2    1</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [43,]    3    2</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [44,]    3    1</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [45,]    2    3</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [46,]    1    2</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [47,]    1    3</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [48,]    1    3</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [49,]    1    2</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [50,]    3    1</span></span></code></pre></div>
<p>A novel feature of this code is that instead of the subsampling method for generating the confidence intervals proposed by Fox (2018), it is also possible to use the cube-root bootstrap method introduced by Cattaneo, Jansson and Nagasawa (2020). The signatures are the same:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>crCubeRoot <span class="ot">&lt;-</span> <span class="fu">cubeRootBootstrapCR</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    dataArray, groupIDs, optResult<span class="sc">$</span>optArg,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    ssSize, numSubsamples, confidenceLevel,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    optimizeScoreArgs)</span></code></pre></div>
<p>See the vignette <em>Calculating confidence regions using the cube-root bootstrap method</em> (accessed by <code>vignettes(&quot;cubeRootBootstrap&quot;</code>) for more details on this method.</p>
</div>
<div id="taking-a-closer-look" class="section level1">
<h1>Taking a closer look</h1>
<div id="importing" class="section level2">
<h2>Importing</h2>
<p>The <code>importMatched</code> function can handle delimiter-separated value files with headers. It supports two modes:</p>
<ul>
<li>identifying fields by their position (the default)</li>
<li>identifying fields by their name</li>
</ul>
<p>The optional argument <code>fieldMode</code> switches between those modes. The exact format of the header and values is explained in more detail in the corresponding documentation.</p>
</div>
<div id="accessing-the-imported-data" class="section level2">
<h2>Accessing the imported data</h2>
<p>We can see how many markets are in the data, how many members each stream has in each market, and how many attributes there are.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>noM</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>noU</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10 10 10</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>noD</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10 10 10</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>noAttr</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span></code></pre></div>
<p>We can also view the file header, containing the field names.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>header</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Market&quot;     &quot;UpStream&quot;   &quot;DownStream&quot; &quot;Distance1&quot;  &quot;Distance2&quot; </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6] &quot;Distance3&quot;  &quot;Distance4&quot;  &quot;Distance5&quot;  &quot;Match&quot;</span></span></code></pre></div>
<p>The <code>matchedData</code> structure exposes two elements, called <code>$distanceMatrices</code> and <code>$matchMatrices</code>. They are lists of size <code>noM</code> each, with each element containing an array with the relevant data for each market:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(matchedData<span class="sc">$</span>distanceMatrices)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(matchedData<span class="sc">$</span>matchMatrices)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Let’s check whether, in the third market, there is a match between the upstream-downstream pair indexed by <span class="math inline">\((4, 7)\)</span>. Note the order in which the indices appear: market, downstream and then upstream. A value of <code>1</code> indicates a match and a value of <code>0</code> indicates the respective upstream-downstream pairing is not a match in the real data.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mIdx <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>uIdx <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>dIdx <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>matchMatrices[[mIdx]][dIdx, uIdx]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>We can also view the matching information for a single stream (upstream or downstream agents).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leaving an index blank takes all elements for that dimension.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>matchMatrices[[mIdx]][, uIdx]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] 1 0 0 1 1 1 1 0 0 0</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># `which` returns the indices where the elements above are `1` -- i.e. the</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># downstream matches of upstream &#39;4&#39;.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(matchedData<span class="sc">$</span>matchMatrices[[mIdx]][, uIdx] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1 4 5 6 7</span></span></code></pre></div>
<p>We can view the distance attributes for a single attribute index, or for the entire attribute range.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>aIdx <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>distanceMatrices[[mIdx]][aIdx, dIdx, uIdx]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 11.85933</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>matchedData<span class="sc">$</span>distanceMatrices[[mIdx]][, dIdx, uIdx]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  8.008747 11.598564 11.859333 13.590409 10.243747</span></span></code></pre></div>
</div>
<div id="accessing-the-inequality-members" class="section level2">
<h2>Accessing the inequality members</h2>
<p>The structure <code>ineqmembers</code> is a list of length <code>noM</code>. Each element contains the indices which define each inequality for that market, packaged in a list.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mIdx <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(ineqmembers)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ineqmembers[[mIdx]])</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;fctUpIdxs&quot; &quot;fctDnIdxs&quot; &quot;cfcUpIdxs&quot; &quot;cfcDnIdxs&quot; &quot;numIneqs&quot;</span></span></code></pre></div>
<p>The <code>numIneqs</code> element is the number of inequalities for that market. The other four elements are lists, with length equal to <code>numIneqs</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ineqmembers[[mIdx]]<span class="sc">$</span>numIneqs</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 45</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(ineqmembers[[mIdx]]<span class="sc">$</span>fctUpIdxs)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 45</span></span></code></pre></div>
<p>Each inequality, when everything has been moved to the LHS, contains terms of the form <span class="math inline">\(f_{\beta}(m, p, q) - f_{\beta}(m, r, s)\)</span>, where <span class="math inline">\(f_{\beta}\)</span> is the payoff function of the match evaluated at the parameter vector <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(f_{\beta}(m, i, j)\)</span> is its value for the upstream-downstream match <span class="math inline">\((i, j)\)</span> of the <span class="math inline">\(m\)</span>-th market. The indices <span class="math inline">\(p, q, r, s\)</span> are stored the vectors <code>$fctUpIdxs</code>, <code>$fctDnIdxs</code>, <code>$cfcUpIdxs</code>, and <code>$cfcDnIdxs</code>, respectively, where <code>fct</code> and <code>cfc</code> correspond to the factual/LHS <span class="math inline">\((p, q)\)</span> and counterfactual/RHS <span class="math inline">\((r, s)\)</span> indices, and <code>Up</code> and <code>Dn</code> to the upstream <span class="math inline">\((p, r)\)</span> and downstream <span class="math inline">\((q, s)\)</span> indices.</p>
<p>For example, let’s choose the first term of the first inequality for the previous match:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mIdx <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>uIdx <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>dIdx <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ineqIdx <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>termIdx <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ineqmembers[[mIdx]]<span class="sc">$</span>fctUpIdxs[[ineqIdx]][termIdx]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ineqmembers[[mIdx]]<span class="sc">$</span>fctDnIdxs[[ineqIdx]][termIdx]</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>ineqmembers[[mIdx]]<span class="sc">$</span>cfcUpIdxs[[ineqIdx]][termIdx]</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ineqmembers[[mIdx]]<span class="sc">$</span>cfcDnIdxs[[ineqIdx]][termIdx]</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>Since the above expressions are cumbersome, we provide the <code>getIneqTermsIdxs</code> and <code>getAllIneqTermsIdxs</code> functions, which provide the above information in a more user-friendly mode. <code>getIneqTermsIdxs</code> returns an array with all indices of a single inequality. <code>getAllIneqTermsIdxs</code> does the same for an entire market.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getIneqTermsIdxs</span>(ineqmembers[[mIdx]], ineqIdx)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       fctUpIdxs fctDnIdxs cfcUpIdxs cfcDnIdxs</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1,]         1         2         1         3</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [2,]         1         3         1         4</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3,]         1         4         1         5</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4,]         1         5         1         8</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5,]         1         6         2         2</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6,]         1         7         2         3</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7,]         1         8         2         4</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [8,]         2         3         2         5</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9,]         2         4         2         6</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10,]         2         5         2         7</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11,]         2         8         2         8</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">getAllIneqTermsIdxs</span>(ineqmembers[[mIdx]])[[ineqIdx]]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       fctUpIdxs fctDnIdxs cfcUpIdxs cfcDnIdxs</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1,]         1         2         1         3</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [2,]         1         3         1         4</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [3,]         1         4         1         5</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [4,]         1         5         1         8</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [5,]         1         6         2         2</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [6,]         1         7         2         3</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7,]         1         8         2         4</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [8,]         2         3         2         5</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [9,]         2         4         2         6</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [10,]         2         5         2         7</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [11,]         2         8         2         8</span></span></code></pre></div>
</div>
<div id="accessing-the-data-array" class="section level2">
<h2>Accessing the data array</h2>
<p>The <code>dataArray</code> object is an array with precomputed values used in calculating the value of the objective function. Its rows correspond to attributes, and its columns to inequalities.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(dataArray)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]   5 135</span></span></code></pre></div>
<p>The <code>dataArray</code> is “flat”, in the sense that there is no distinction between markets. To recover that distinction, we need to create a mapping from its column indices to the market indices. This is handled by the function <code>makeGroupIDs</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>groupIDs</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [38] 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [75] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [112] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span></span></code></pre></div>
<p>We can now choose the columns corresponding to the second market…</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mIdx <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>qualifiedIndices <span class="ot">&lt;-</span> <span class="fu">which</span>(groupIDs <span class="sc">==</span> mIdx)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>qualifiedIndices</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [26] 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>dataArray[, qualifiedIndices]</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            [,1]        [,2]      [,3]       [,4]         [,5]       [,6]</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] -0.1927787   2.5776567  17.46119 -21.298803  -2.65466248  -4.724751</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 17.3655012 -32.3778088  24.02079  -1.909185  -0.08167787 -45.873622</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 10.7477101  20.2971071 -19.18729  18.065350 -23.48220266 -22.839303</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 14.6777601 -15.5269929 -14.31887  13.395478   7.47332535  25.604638</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 20.7250817   0.4481406  25.47335   8.792046 -27.93826221   2.274577</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           [,7]       [,8]        [,9]     [,10]       [,11]      [,12]</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] -20.44683  -4.344083   0.4921755 -8.443350 -24.9750577 -0.5949503</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -17.77701 -19.805698 -16.4287351  9.299360  33.1252774  6.3492762</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] -27.30937  27.503520 -23.5636917 -2.245099  10.8996568 -1.4467360</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] -27.30577 -16.231023   9.3142182  4.256938   0.1480077 -3.7166944</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] -10.61373  16.056015  -0.8931647  4.983888  -8.1299262  2.8374448</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            [,13]      [,14]     [,15]     [,16]      [,17]       [,18]</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] -21.7357750 -0.6835568 -24.76306 16.455311 -12.853175   0.4676557</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]   2.0023014  9.3632934  14.96228  3.223787   1.290955  14.1917768</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]   0.5505034 12.9546855  20.20350 -8.992664 -10.416904   1.7675828</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]  -6.6875202  8.3333173 -20.85839 -8.404990   6.637616  32.7569175</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] -26.0729922 34.4582509  22.87800 12.196296   5.099679 -12.8597772</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           [,19]       [,20]    [,21]     [,22]       [,23]     [,24]     [,25]</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]   7.880509  -6.6034730 13.77559  0.817574 -11.1366001 -27.50987  7.555758</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -46.902199 -37.3641315 10.67505 16.332860   0.3514265  -1.51189  6.190431</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] -11.251869   0.1059729 18.24765 34.349389 -14.7108411  16.79111  5.820747</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]   3.984028   6.8673085  5.86132 -7.742411  10.5821425  -4.56776 -7.254219</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] -16.591970  -6.0108334 25.07188 15.882866  25.2875563  27.46869 12.359115</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           [,26]      [,27]      [,28]      [,29]      [,30]      [,31]</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] -16.931818 -21.499204 -41.040167   9.067017 -32.806099  -4.571771</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,]  23.929108 -13.107885  32.791354   3.419514  22.702500 -19.512329</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] -19.770821  -3.127497 -17.220640  -8.208726 -39.142531  -9.848632</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]  -2.696569  15.176583 -29.944293 -20.631639  -3.908234   2.522520</span></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] -12.304777  32.495334   9.713356   6.911940  24.107928  -4.874243</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           [,32]      [,33]     [,34]      [,35]      [,36]      [,37]</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,]  -4.281715 -11.118642  10.80533   9.945179 -33.015274 -14.524129</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -18.230642  -8.613543 -23.57832   6.499854 -16.670126  18.889570</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]  11.141593  13.337524  15.80854 -15.575402  10.649743   4.588387</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]  30.315037  -8.427378  15.82515   2.169121  13.582702  -3.927695</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,]  45.715786   8.368277  -3.82675   6.551921  -1.971473  -2.961302</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           [,38]      [,39]       [,40]      [,41]      [,42]      [,43]</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] -11.536279 -21.957123 -16.5136129   9.033874 -11.926529  -8.162054</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] -29.970581   1.813378 -14.2769113 -21.599329  19.576462  -9.969698</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,]  -3.515045  -3.515560  -0.1524136  10.086624   1.653058  30.717301</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,]  11.536438   7.873052  -1.8904933  39.807873  31.980548   4.537117</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] -10.567278  -6.952115   0.2732701  23.487614  25.125165 -18.203219</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          [,44]      [,45]</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] -8.424042  -6.044203</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 16.814274 -10.886824</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] -2.597653  -9.284233</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 20.174099  16.818038</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 14.638851  24.645734</span></span></code></pre></div>
<p>…or, more generally, to a subset of market indices:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>selectedGroups <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>qualifiedIndices <span class="ot">&lt;-</span> <span class="fu">which</span>(groupIDs <span class="sc">%in%</span> selectedGroups)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>qualifiedIndices</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [20]  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [39]  39  40  41  42  43  44  45  91  92  93  94  95  96  97  98  99 100 101 102</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [58] 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [77] 122 123 124 125 126 127 128 129 130 131 132 133 134 135</span></span></code></pre></div>
</div>
<div id="optimization" class="section level2">
<h2>Optimization</h2>
<p>The function <code>makeBounds</code> creates equal symmetrical box constraints for each variable estimate:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">makeBounds</span>(matchedData<span class="sc">$</span>noAttr, <span class="dv">100</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lower</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -100 -100 -100 -100</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $upper</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100 100 100 100</span></span></code></pre></div>
<p>If non-symmetrical constraints for the estimates are desired, we can pass a third argument to the function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">makeBounds</span>(matchedData<span class="sc">$</span>noAttr, <span class="dv">10</span>, <span class="sc">-</span><span class="dv">20</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lower</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -20 -20 -20 -20</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $upper</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 10 10 10 10</span></span></code></pre></div>
<p>Otherwise, we can also create custom bounds. That object should be a list with elements named <code>$lower</code> and <code>$upper</code>. Each element is a vector defining lower and upper bounds for each variable.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>bounds <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">lower=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">5</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>bounds</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lower</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -1 -2 -3 -5</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $upper</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2 3 5 8</span></span></code></pre></div>
<p>Note that since we have 5 distance attributes, the number of free parameters is 4.</p>
<p><code>getDefaultOptimParams</code> returns a reasonable collection of parameters for the Differential Evolution method. Therefore, the user should impose constraints on the parameter estimates only if they have reasons to suspect the data is of a particular form that requires such constraints.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>optimParams</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $NP</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 50</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $F</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.6</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $CR</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.5</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $itermax</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 100</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $trace</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $reltol</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.001</span></span></code></pre></div>
<p>See the documentation of <code>DEoptim::DEoptim.control</code> for more information and how to fine-tune the parameters of the Differential Evolution method to obtain better results for a given data.</p>
<p>To see the original names of the distance attributes for the optimal parameter vector, one can use the following commands:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>distNames <span class="ot">&lt;-</span> matchedData<span class="sc">$</span>header[matchedData<span class="sc">$</span>colIdxs<span class="sc">$</span>distanceColIdxs]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop first value.</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>distNamesFree <span class="ot">&lt;-</span> distNames[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(optResult<span class="sc">$</span>optArg) <span class="ot">&lt;-</span> distNamesFree</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>optResult<span class="sc">$</span>optArg</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Distance2 Distance3 Distance4 Distance5 </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   1.81745  -2.75489  87.03322 -17.54139</span></span></code></pre></div>
<div id="restarting-the-optimization-multiple-times" class="section level3">
<h3>Restarting the optimization multiple times</h3>
<p>Since we are dealing with an optimization problem with multiple solutions, we provide an option to restart optimization procedures, such as <em>Differential Evolution</em>, that depend on the state of the random generator. By using a different random state on each run, the optimal parameter vectors calculated on each run will also vary. The user can then choose one or more solutions according to their own criteria. The overall goal is to reach the maximum number of inequalities predicted.</p>
<p>Setting the parameter <code>numRuns</code> in <code>optimizeScoreFunction()</code> to an integer greater than <code>1</code> will restart the optimization procedure that many times. The list <code>bestRuns</code> then collects the results that share the overall best score value (that is, it collects the solution(s) that provide(s) the highest number of inequalities predicted).</p>
<p>It might be helpful to set the <code>progressUpdate</code> parameter to a positive value, in order to track the progress of the long-running operation.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>optimizeScoreArgs<span class="sc">$</span>bounds <span class="ot">&lt;-</span> bounds <span class="ot">&lt;-</span> <span class="fu">makeBounds</span>(matchedData<span class="sc">$</span>noAttr, <span class="dv">10</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>optimizeScoreArgs<span class="sc">$</span>numRuns <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>optimizeScoreArgs<span class="sc">$</span>progressUpdate <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>optResult <span class="ot">&lt;-</span> <span class="fu">do.call</span>(optimizeScoreFunction, optimizeScoreArgs)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 50</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 100</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 150</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 200</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 250</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 300</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 350</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 400</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 450</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 500</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 550</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 600</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 650</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 700</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 750</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 800</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 850</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 900</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 950</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [optimizeScoreFunction] Iterations completed: 1000</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co"># How many runs, out of the initial 1000, gave the best overall score?</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(optResult<span class="sc">$</span>bestRuns)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 115</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the result of the 100th such run.</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>optResult<span class="sc">$</span>bestRuns[[<span class="dv">100</span>]]</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $optVal</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.7037037</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $optArg</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1]  0.9603911 -5.1550538  2.5772195  0.1712763</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $ineqSat</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [1] 1 1 1 1 1 1 1 1 1 1 0 1 0 0 1 1 0 1 1 1 1 1 1 0 0 1 0 1 0 0 1 1 1 1 1 1 0</span></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [38] 1 0 1 1 1 1 1 1 1 0 1 0 1 1 1 0 1 1 0 1 0 0 0 1 1 1 1 0 0 0 1 0 0 1 1 1 1</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [75] 1 1 1 0 0 1 0 0 1 1 0 1 1 0 1 1 1 0 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 0 0 1 0</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [112] 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 0 0 1</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li>[1] Fox, J.T. (2018). Estimating matching games with transfers. <em>Quantitative Economics</em>, 9: 1-38. <a href="https://doi.org/10.3982/QE823" class="uri">https://doi.org/10.3982/QE823</a></li>
<li>[2] Romano, J. P. and A. M. Shaikh (2008). Inference for identifiable parameters in partially identified econometric models. <em>Journal of Statistical Planning and Inference</em>, 138 (9), 2786–2807. <a href="https://doi.org/10.1016/j.jspi.2008.03.015" class="uri">https://doi.org/10.1016/j.jspi.2008.03.015</a></li>
</ul>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
